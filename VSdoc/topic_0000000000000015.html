<?xml version="1.0" encoding="utf-8"?><html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta name="ROBOTS" content="NOINDEX, NOFOLLOW" />
    <title>BookingViewModelsController.ConfirmVisit (Booking) Method</title>
    <meta name="Microsoft.Help.TopicVersion" content="10" />
    <meta name="Microsoft.Help.Id" content="M:AlfaAccounting.Controllers.BookingViewModelsController.ConfirmVisit(AlfaAccounting.Models.Booking)" />
    <meta name="SelfBranded" content="false" />
    <meta name="Title" content="BookingViewModelsController.ConfirmVisit (Booking) Method" />
    <meta name="Microsoft.Help.TocParent" content="Overload:AlfaAccounting.Controllers.BookingViewModelsController.ConfirmVisit" />
    
    <meta name="Microsoft.Help.ContentType" content="Reference" />
    <meta name="Microsoft.Help.Category" content="TargetOS:Windows" />
    <meta name="Microsoft.Help.Category" content="DevLang:VB" />
    <meta name="Microsoft.Help.Category" content="DevLang:CSharp" />
    <meta name="Microsoft.Help.Category" content="DevLang:FSharp" />
    <meta name="Description" content="AlfaAccounting.Controllers.BookingViewModelsController.ConfirmVisit Method" />
    <meta name="Microsoft.Help.TOCParentTopicVersion" content="10" />
    <meta name="Microsoft.Help.TocOrder" content="0" />
    <meta name="Microsoft.Help.Product" content="AlfaAccounting Reference" />
    <style type="text/css">.class-diagram img {border: none;}</style>
    <script src="mshv2.js"></script>
  </head>
    <body class="primary-mtps-offline-document" 
	onload="try{onLoad(); var nod=document.getElementById('vsdocman_init_script');var newNod=document.createElement('script');newNod.type= 'text/javascript';nod.parentNode.replaceChild(newNod,nod);newNod.text=nod.innerHTML;vsdocman_topic_init();}catch(ex){}">
  
<div id="vsdocman_init_script" style="display:none;">
// <!-- the script cannot contain the following text (without dots): -.-.> or -.-
function vsdocman_topic_init() {
	try {
		extractCode();
	} catch (ex) {
	}
	
	try {
		var divs = document.documentElement.getElementsByTagName("div");
		var i;
		var footerRemoved = false;
		for (i=divs.length-1; i>=0; i=i-1) {
			var div = divs[i];
	
			// remove VS branding footer
			if (!footerRemoved) {
				if (div.className == "OH_footer") {
					div.style.display = "none";
					footerRemoved = true;
				}
			}
			
			// remove VS branding feedback link
			if (div.className == "OH_feedbacklink") {
				div.style.display = "none";
			}
		}

		var tds = document.documentElement.getElementsByTagName("td");
		for (i=0; i<tds.length; i++) {
			var td = tds[i];
	
			// remove VS branding logo
			if (td.className == "OH_tdLogoColumn") {
				td.style.display = "none";
			}
		}
	} catch (ex) {
	}
	
	hideImageMapAreaLinks();
	fixLinks();
	fixNewlinesInSyntax();
}


/**
 * Fixes <br />\n sequences in syntax declarations. Only <br/> 
 * is needed.
 */  
function fixNewlinesInSyntax() {
	try {
		var i;
		var snippets = document.documentElement.getElementsByTagName("CodeSnippet");
		for (i=0; i<snippets.length; i++) {
			var containsMarkup = snippets[i].getAttribute("ContainsMarkup");
			if (containsMarkup == "true") {
				// it is syntax section
				// surround fixed text with <pre> tag, otherwise IE normalizes all whitespaces during setting innerHTML
				snippets[i].parentNode.innerHTML = "<pre>" + snippets[i].parentNode.innerHTML.replace(/<br>\r?\n/gi, "<br>") + "</pre>";
			}
		}
	} catch (ex) {
	}
}


/**
 * MS Help Viewer (at least version 1) removes style="display:none;". 
 * Set it back.
 */  
function hideImageMapAreaLinks() {
	try {
		var i;
		var maps = document.documentElement.getElementsByTagName("map");
		for (i=0; i<maps.length; i++) {
			var mapId = maps[i].getAttribute("name");
			var invisibleLinks = document.getElementById("invisible_imagemap_links_" + mapId);
			invisibleLinks.style.display="none";
		}
	} catch (ex) {
	}
}


// Escapes id query variables in internal links and corrects external links. 
function fixLinks() {
	try {
		var i;
		var links = document.documentElement.getElementsByTagName("a");
		var urlParameters = getUrlParameters();
		for (i=0; i<links.length; i++) {
			var hrf = links[i].getAttribute("hr" + "ef");
			var escaped = escapeIdQueryVariable(hrf);
			
			var idValue = escaped[1];
			if (idValue != "") {
				var isExternal = (idValue.toLowerCase().indexOf("http://", 0) >= 0);
				isExternal = isExternal || (idValue.toLowerCase().indexOf("https://", 0) >= 0);
				var isHttp = isExternal;
				isExternal = isExternal || (idValue.toLowerCase().indexOf("mailto:", 0) >= 0);
				if (isExternal) {
					// external link
					//  Help3 system converts each Id to uppercase, so convert it to lowercase.
					//  It's bigger chance the URL will be correct.
					hrf = idValue.toLowerCase();
					if (isHttp) {
						links[i].className = "mtps-external-link";
					}
				} else {
					// help3 link
					hrf = escaped[0];
					// some links (e.g. in syntax section) don't have complete parameters generated by Help3 system
					if (hrf.indexOf("method=page", 0) < 0) {
						hrf = hrf + "&" + urlParameters;
					}
				}
	
				links[i].setAttribute("hr" + "ef", hrf);
			}
		}
	} catch (ex) {
	}
}


var idQueryVariablePattern = /(\&|\?|^)(id\=)(.*?)(\&|$)/i;

// Returns array with 2 items. The first one is resulting complete queryString with
// escaped id variable. The second one is original value of id variable. 
function escapeIdQueryVariable(input) {
	var match = input.match(idQueryVariablePattern);
	var idValue = "";
	if (match) {
		idValue = input.match(idQueryVariablePattern)[3];
		input = input.replace(idQueryVariablePattern, "$1$2" + escape(idValue) + "$4");
	}
	var res = new Array();
	res[0] = input;
	res[1] = idValue;
	return res;
} 


function getUrlParameters() {
	var res;
	res = "product=" + getQueryVariable("product") + "&";
	res = res + "productversion=" + getQueryVariable("productversion") + "&";
	res = res + "method=page&";
	return res;
}


function getQueryVariable(variable) {
  var query = window.location.search.substring(1);
  var vars = query.split("&");
  for (var i=0; i<vars.length; i++) {
    var pair = vars[i].split("=");
    if (pair[0].toLowerCase() == variable.toLowerCase()) {
      return pair[1];
    }
  }
  return "";
} 


function extractCode(parentNode) {
	var comments = getAllComments(parentNode);

	var comment;
  for(var i=0; i<comments.length; i++){
    comment = comments[i];
  	var matches = comment.nodeValue.match(/(?:^\s*VSDOCMAN SCRIPT)((.|\r\n)*)$/);
		// Match returns array. Index 0 is complete match. Index 1 is the first captured group.
		// The group is defined by (). The ?: means that the group is not captured. 
  	if (matches != null) {
	    //res.push(matches[1]);
	    createElement("div", matches[1], comment);
    }
  }
}


function getAllComments(parentNode) {
	if (parentNode == null) {
		parentNode = document.documentElement;
	}
	var children = parentNode.childNodes;
	var res = new Array();
  if(parentNode.nodeType == 8){
  	// 8 = comment
    res.push(parentNode);
  }
	    
  for(var i=0; i<children.length; i++){
      res = res.concat(getAllComments(children[i]));
  }
  return (res);
}


// Create new element and replace existing one with it
function createElement(name, innerHtml, oldElm) {
	// setting innerHTML containing script tags doesn't work in IE
	var scriptBodies = new Array();
	var scriptMatch;
	var i = 0;
	var scriptPattern = /(<script.*?>)((.|\r\n)*?)(<\/script>)/i;
	do {
		scriptMatch = innerHtml.match(scriptPattern);
		if (scriptMatch != null) {
			// found the script tag
			//  get its innerHtml
			scriptBodies[i] = scriptMatch[2];
			// replace this script tag with span tag
			innerHtml = innerHtml.replace(scriptPattern, "<span script_index=\"" + i + "\"></span>");
		}
		i++;
	} while(scriptMatch != null && i < 100);
	
	var elm = document.createElement(name);
	elm.innerHTML = innerHtml;
	oldElm.parentNode.replaceChild(elm,oldElm);
	
	// now create script tags and replace corresponding span tags
	var allSpans = elm.getElementsByTagName('span');
	var scriptSpans = new Array();
	for (i=0; i<allSpans.length; i++) {
		if (allSpans[i].getAttribute("script_index")) {
			var index = allSpans[i].getAttribute("script_index");
			scriptSpans[index] = allSpans[i];
		}
	}
	for (i=0; i<scriptBodies.length; i++) {
		insertScriptElement(scriptBodies[i], scriptSpans[i], getUniqueIndex());
	}
}

var uniqueIndex = 0;
function getUniqueIndex() {
	return uniqueIndex++;
}

function insertScriptElement(innerHtml, oldNode, scriptIndex) {
	var newNod=document.createElement('script');
	newNod.type = 'text/javascript';
	newNod.setAttribute("defer", "defer");
	oldNode.parentNode.replaceChild(newNod, oldNode);
	// add a test whether the script was evaluated
	var newInnerHtml = "\nvar vsdocmanScript" + scriptIndex + "executed = true;\n" + innerHtml;
	newNod.text=newInnerHtml;
	//run the script if necessary
	try {
		eval("vsdocmanScript" + scriptIndex + "executed");
	} catch (ex) {
		// not evaluated yet
		eval(innerHtml);
	}
}

// *** CLASS DIAGRAM CLICKING ***
// To navigate any kind of link, we need to call click() method on the element.
// It's because of <MSHelp:link links in Help2 format (only used in IE). 
// Default click event in FF doesn't trigger the link (in IE it does).
// Fix it. 
function performClick(element) {
	if (document.createEventObject){
		// IE
		return element.click();
	}
	else{
		// dispatch for firefox + others
		var evt = element.ownerDocument.createEvent('MouseEvents');
		evt.initMouseEvent('click', true, true, element.ownerDocument.defaultView, 1, 0, 0, 0, 0, false, false, false, false, 0, null);
		element.dispatchEvent(evt);
	}
	
	while (element) {
		if (element.tagName == "A" && element.href != "") {
			if (element.target != "") {
				window.open(element.href, element.target);
			} else {
				document.location = element.href;
			}
			element = null;
		}	else {
			element = element.parentElement;
		}
	}
}

function clickElement(callerElement) {
	try {
		var elementHTML;
		var tagName;
		var innerCode;
		var attributes;
		var clickActionGuid;
		
		// get HTML source code of element to be clicked 
		clickActionGuid = callerElement.getAttribute("click-cref-guid");
		elementHTML = document.getElementById(clickActionGuid).innerHTML;
		
		// parse HTML element code
		var elementPattern = /<(.+?)\s+(.*)>(.*)<.+?>/igm;
		elementPattern.lastIndex = 0;
		var match = elementPattern.exec(elementHTML);
		tagName = match[1];
		attributes = match[2];
		innerCode = match[3];
		
		//get array of "attr=value" strings 	
		attributes = unescapeHTML(attributes);
		attributes = attributes.match(/\s*(.*?)\s*=\s*(["'])(.*?)\2/igm);
		
		// create element with attributes
		var el = document.createElement(tagName);
		//el.innerHTML = innerCode;
		var i;
		var attrPattern = /\s*(.*?)\s*=\s*(["'])(.*?)\2/igm;
		for (i=0; i<attributes.length; i++) {
			attrPattern.lastIndex = 0;
			match = attrPattern.exec(attributes[i]);
			el.setAttribute(match[1], match[3]);
		}

		document.body.appendChild(el);
		performClick(el);
	} catch (ex) {
	}
	return false;
}

function unescapeHTML (str) {
	return str.replace(/&amp;/g,"&").
		replace(/>/g,"&gt;").
		replace(/</g,"&lt;");//. 
		//the following doesn't work for some reason: replace(/"/g,"&quot;");                                         
}

// -->		
</div>
    <div class="topic">
      <div class="majorTitle">AlfaAccounting Reference
      </div>
      <div class="title">BookingViewModelsController.ConfirmVisit (Booking) Method
      </div>
      <div id="mainSection">
        <div id="mainBody">
          <div>
            <div class="summary">
       
			        Get posted booking data,depending on the booking status chosen manipulate data and redirect to apprprirate view
if booking status is unchanged or curtailed/extended without adjustment hrs input returns current view with error
if booking status is visited, startDate, endDate, and item description updated and the booking saved to database Returns AdminBooking View
if booking status is extended, subtotal, deposit cancellationfee value, startDate, endDate, and item description


            </div>
          </div>
          <p>
          </p>

          <strong>Namespace:</strong> 
<a href="ms-xhelp:///?Id=N:AlfaAccounting.Controllers">AlfaAccounting.Controllers</a>



<br />

    
          <strong>Assembly:</strong>
          <span>AlfaAccounting (in AlfaAccounting.dll)</span>








<CollapsibleArea runat="server" Expanded="1" Title="Syntax" xmlns="http://msdn2.microsoft.com/mtps">
  <a id="syntaxToggle" xmlns="http://www.w3.org/1999/xhtml">
  </a>

            
            
						
	<CodeSnippet xml:space="preserve" runat="server" Language="CSharp" DisplayLanguage="C#" ContainsMarkup="true" EnableCopyCode="false">[HttpPost()]
[ValidateAntiForgeryToken()]
public Task&#60;ActionResult&#62; ConfirmVisit(
   [Bind(Include = &#34;BookingId,BookedDate,BookingStartDateTime,BookingEndDateTime,BookingStatus,BookingAdjustmentHrs,ItemDescription,Subtotal,BookingDeposit,BookingCancellationFee,UnitPriceId,Id,InvoiceId&#34;)]
   Booking booking
)</CodeSnippet>
            
						
            
						





<div id="parameters" xmlns="http://www.w3.org/1999/xhtml">
  <h4 class="subHeading">Parameters</h4>  <dl>
    <dt>
      <span class="parameter">booking</span>
    </dt>
    <dd>
      <span>
        <span>Type: <a href="ms-xhelp:///?Id=">Booking</a></span>
        <br />
      </span>
      <span>
        <span></span>
        <br />
      </span>
    </dd>
  </dl>

</div>

<div id="returns" xmlns="http://www.w3.org/1999/xhtml">
  <h4 class="subHeading">Return Value</h4>
  <span>
	Type: <a href="ms-xhelp:///?Id=T:System.Threading.Tasks.Task`1">Task</a>&#60;<a href="ms-xhelp:///?Id=T:System.Web.Mvc.ActionResult">ActionResult</a>&#62;<br />
	
  </span>
</div>










</CollapsibleArea>





















<CollapsibleArea runat="server" Expanded="1" Title="Source code" xmlns="http://msdn2.microsoft.com/mtps">
  <a id="sourceCodeToggle" xmlns="http://www.w3.org/1999/xhtml">
  </a>
  <div id="snippetGroup" xmlns="http://www.w3.org/1999/xhtml">

<CodeSnippet EnableCopyCode="true" runat="server" Language="CSharp" ContainsMarkup="false" DisplayLanguage="C#" xmlns="http://msdn2.microsoft.com/mtps">
[HttpPost]
 [ValidateAntiForgeryToken]
 public async Task&#60;ActionResult&#62; ConfirmVisit([Bind(Include = &#34;BookingId,BookedDate,BookingStartDateTime,BookingEndDateTime,BookingStatus,BookingAdjustmentHrs,ItemDescription,Subtotal,BookingDeposit,BookingCancellationFee,UnitPriceId,Id,InvoiceId&#34;)] Booking booking)
 {
     var bookingOriginal = TempData[&#34;BookingOriginal&#34;] as Booking;
     var invoiceOriginal = TempData[&#34;InvoiceOriginal&#34;] as Invoice;
 
     if (booking.BookingStatus == BookingStatus.Booked)
     {
         TempData[&#34;ConfirmVisitError&#34;] = &#34;Booking status must be changed&#34;;
         return RedirectToAction(&#34;ConfirmVisit&#34;);
     }
     if ((booking.BookingStatus == BookingStatus.Curtailed || booking.BookingStatus == BookingStatus.Extended) &#38;&#38; booking.BookingAdjustmentHrs == 0)
     {
         TempData[&#34;ConfirmVisitError&#34;] = &#34;You must input adjustment hours&#34;;
         return RedirectToAction(&#34;ConfirmVisit&#34;);
     }
     //to booking, allocate subtotal, deposit, cancellationfee value depending on the booking status chosen
     //save item description to booking as it is null at the moment
     booking.ItemDescription = bookingOriginal.ItemDescription;
     booking.Id = bookingOriginal.Id;
     booking.BookingId = bookingOriginal.BookingId;
     //get depostirate
     var depositrate = (float)db.DepositRates.SingleOrDefault().DepositRateValue;
     //check if unit price has changed in model, 
     //if so set current unit price as model to calculate else use original one.
     var orginalBkgUnitPrice = (float)db.UnitPrices.Where(i =&#62; i.UnitPriceId == bookingOriginal.UnitPriceId).FirstOrDefault().UnitPriceValue;
     var thisBkgUnitPrice = (float)db.UnitPrices.Where(i =&#62; i.UnitPriceId == booking.UnitPriceId).FirstOrDefault().UnitPriceValue;
     var currentUnitPrice = 0f;
     if (orginalBkgUnitPrice == thisBkgUnitPrice)
     { currentUnitPrice = orginalBkgUnitPrice; }
     else { currentUnitPrice = thisBkgUnitPrice; }
     if (booking.BookingStatus == BookingStatus.Visited)
     {
         booking.Subtotal = bookingOriginal.Subtotal;
         booking.BookingDeposit = bookingOriginal.BookingDeposit;
         booking.BookingCancellationFee = bookingOriginal.BookingCancellationFee;
         if (ModelState.IsValid)
         {
             db.Entry(booking).State = EntityState.Modified;
             db.SaveChanges();
             //return RedirectToAction(&#34;Index&#34;);
         }
     }
     if (booking.BookingStatus == BookingStatus.Extended)
     {
         booking.Subtotal = bookingOriginal.Subtotal + ((float)booking.BookingAdjustmentHrs * currentUnitPrice);
         booking.BookingDeposit = bookingOriginal.BookingDeposit;
         booking.BookingCancellationFee = bookingOriginal.BookingCancellationFee;
         if (ModelState.IsValid)
         {
             db.Entry(booking).State = EntityState.Modified;
             db.SaveChanges();
             //return RedirectToAction(&#34;Index&#34;);
         }
     }
 
     if (booking.BookingStatus == BookingStatus.Curtailed)
     {
         var amountToBeDeducted = (float)booking.BookingAdjustmentHrs * currentUnitPrice;
         var remainingAmount = (float)bookingOriginal.Subtotal - (float)bookingOriginal.BookingDeposit;
         if (amountToBeDeducted &#62; remainingAmount)
         {
             booking.Subtotal = bookingOriginal.Subtotal - bookingOriginal.Subtotal;
             booking.BookingDeposit = bookingOriginal.BookingDeposit - (amountToBeDeducted - remainingAmount);
             booking.BookingCancellationFee = bookingOriginal.BookingCancellationFee;
         }
         else
         {
             booking.Subtotal = bookingOriginal.Subtotal - amountToBeDeducted;
             booking.BookingDeposit = bookingOriginal.BookingDeposit;
             booking.BookingCancellationFee = bookingOriginal.BookingCancellationFee;
             if (ModelState.IsValid)
             {
                 db.Entry(booking).State = EntityState.Modified;
                 db.SaveChanges();
                 //return RedirectToAction(&#34;Index&#34;);
             }
         }
     }
     if (booking.BookingStatus == BookingStatus.Cancelled)
     {
         booking.Subtotal = bookingOriginal.Subtotal - bookingOriginal.Subtotal;
         booking.BookingDeposit = bookingOriginal.BookingDeposit - bookingOriginal.BookingDeposit;
         booking.BookingCancellationFee = bookingOriginal.BookingCancellationFee;
     }
 
 
     //to booking, allocate subtotal, deposit, cancellationfee value depending on the booking status chosen
     //find the invoice record that needs to be updated by the id
 
     var selectedInv = (Invoice)db.Invoices.Where(i =&#62; i.InvoiceId == booking.InvoiceId).FirstOrDefault();
     if (booking.BookingStatus == BookingStatus.Visited)
     {   //add remaining aount
         selectedInv.ReceivableRemainingAmount = selectedInv.ReceivableRemainingAmount + (booking.Subtotal - bookingOriginal.BookingDeposit);
 
 
         if (ModelState.IsValid)
         {
             db.Entry(selectedInv).State = EntityState.Modified;
             db.SaveChanges();
 
             //to find out if it is ok to send out invoice
             //check if total booking subtotal amount equals to total invoiced amount
             float subtotalSumOfBookings = 0f;
             selectedInv.Bookings.ToList().ForEach(i =&#62; subtotalSumOfBookings += i.Subtotal);
             float invoicedSumOfInvoice
             = selectedInv.ReceivableDepositAmount - selectedInv.PayableDepositAmount
             + selectedInv.ReceivableRemainingAmount - selectedInv.PayableAmount + selectedInv.InvoiceCancellationFee;
             if (invoicedSumOfInvoice == subtotalSumOfBookings)
             {
                 //send Invoice and payment request email
                 string callbackUrl = await SendInvoiceUrlEmailTokenAsync(invoiceOriginal.Id, invoiceOriginal.InvoiceId, &#34;Your Invoice and payment request from Alfa Accounting&#34;);
             }
             return RedirectToAction(&#34;InvoiceIndex&#34;);
         }
     }
     if (booking.BookingStatus == BookingStatus.Extended)
     {
         var originalRemainingAmount = (float)(bookingOriginal.Subtotal - bookingOriginal.BookingDeposit);
         var aditionalcharge = (float)(booking.BookingAdjustmentHrs * currentUnitPrice);
         selectedInv.ReceivableRemainingAmount = selectedInv.ReceivableRemainingAmount + aditionalcharge + originalRemainingAmount;
         if (ModelState.IsValid)
         {
             db.Entry(selectedInv).State = EntityState.Modified;
             db.SaveChanges();
             //send Invoice and payment request email
             string callbackUrl = await SendInvoiceUrlEmailTokenAsync(invoiceOriginal.Id, invoiceOriginal.InvoiceId, &#34;Your Invoice and payment request from Alfa Accounting&#34;);
             return RedirectToAction(&#34;InvoiceIndex&#34;);
         }
     }
     //if curtailed and if curtailed hr deduction is more than original remaining amount,
     //save amended booking and amdend invoice and pass it to create controller so that when payment is successful, 
     //the those detail are saved.
     if (booking.BookingStatus == BookingStatus.Curtailed)
     {
         var amountToBeDeducted = (float)booking.BookingAdjustmentHrs * currentUnitPrice;
         var remainingAmount = (float)bookingOriginal.Subtotal - (float)bookingOriginal.BookingDeposit;
         if (amountToBeDeducted &#62; remainingAmount)
         {
             selectedInv.ReceivableRemainingAmount = selectedInv.ReceivableRemainingAmount - selectedInv.ReceivableRemainingAmount;
             selectedInv.ReceivableDepositAmount = selectedInv.ReceivableDepositAmount - (amountToBeDeducted - remainingAmount);
             selectedInv.InvoiceCancellationFee = selectedInv.InvoiceCancellationFee + bookingOriginal.BookingCancellationFee;
         }
         else
         {
             selectedInv.ReceivableRemainingAmount = selectedInv.ReceivableRemainingAmount + bookingOriginal.Subtotal - amountToBeDeducted;
             selectedInv.ReceivableDepositAmount = bookingOriginal.BookingDeposit;
             selectedInv.InvoiceCancellationFee = selectedInv.InvoiceCancellationFee + bookingOriginal.BookingCancellationFee;
             if (ModelState.IsValid)
             {
                 db.Entry(selectedInv).State = EntityState.Modified;
                 db.SaveChanges();
                 //send Invoice and payment request email
                 string callbackUrl = await SendInvoiceUrlEmailTokenAsync(invoiceOriginal.Id, invoiceOriginal.InvoiceId, &#34;Your Invoice and payment request from Alfa Accounting&#34;);
                 return RedirectToAction(&#34;InvoiceIndex&#34;);
 
             }
         }
     }
     if (booking.BookingStatus == BookingStatus.Cancelled)
     {
         selectedInv.PayableAmount = selectedInv.PayableAmount + selectedInv.PayableAmount;
         selectedInv.PayableDepositAmount = selectedInv.PayableDepositAmount + bookingOriginal.BookingDeposit;
         selectedInv.InvoiceCancellationFee = selectedInv.InvoiceCancellationFee + selectedInv.InvoiceCancellationFee;
     }
 
     //TempData[&#34;alertMessage&#34;] = &#34;If you cartailed your service or cancelled booking, you now need to refund the difference manually from refund section&#34;;
     if (booking.BookingStatus == BookingStatus.Curtailed || booking.BookingStatus == BookingStatus.Cancelled)
     {
         TempData[&#34;BookingOriginal&#34;] = bookingOriginal;
         TempData[&#34;BookingUpdated&#34;] = booking;
         TempData[&#34;InvoiceOriginal&#34;] = invoiceOriginal;
         TempData[&#34;InvoiceUpdated&#34;] = selectedInv;
         return RedirectToAction(&#34;VisitRefundConfirmation&#34;);
     }
 
     //change payemnt Id data
 
     //change payment history data
 
 
 
     ViewBag.Id = new SelectList(db.Users, &#34;Id&#34;, &#34;Companyname&#34;, booking.Id);
     ViewBag.InvoiceId = new SelectList(db.Invoices, &#34;InvoiceId&#34;, &#34;Id&#34;, booking.InvoiceId);
     ViewBag.UnitPriceId = new SelectList(db.UnitPrices, &#34;UnitPriceId&#34;, &#34;UnitPriceValue&#34;, booking.UnitPriceId);
 
     return View(booking);
 }
</CodeSnippet>

  </div>
</CollapsibleArea>



<CollapsibleArea runat="server" Expanded="1" Title="Platforms" xmlns="http://msdn2.microsoft.com/mtps">
  <a id="platformsTitleToggle" xmlns="http://www.w3.org/1999/xhtml">
  </a>
  
  <p> Windows 7 and above</p>
  <p>
  </p>

  <span xmlns="http://www.w3.org/1999/xhtml">
		The .NET Framework does not support all versions of every platform. For a list of the supported versions, see 
		<a href="ms-xhelp:///?Id=298275e2-da1d-4618-9f74-6a3567832350">System Requirements</a>.
  </span>
</CollapsibleArea>



  



	
	
	
	


<CollapsibleArea runat="server" Expanded="1" Title="Version Information" xmlns="http://msdn2.microsoft.com/mtps">
  <a id="versionsTitleToggle" xmlns="http://www.w3.org/1999/xhtml">
  </a>
  <h4 class="subHeading">.NET Framework</h4>Supported in: 4.6, 4.5, 4, 3.5, 3.0, 2.0, 1.1, 1.0<br />

  <h4 class="subHeading">.NET Framework Client Profile</h4>Supported in: 4, 3.5 SP1<br />






</CollapsibleArea>

<CollapsibleArea runat="server" Expanded="1" Title="See Also" xmlns="http://msdn2.microsoft.com/mtps">
  <a id="seeAlsoToggle" xmlns="http://www.w3.org/1999/xhtml"><!---->
  </a>
  <h4 class="subHeading" xmlns="http://www.w3.org/1999/xhtml">Reference</h4>
		  <div class="seeAlsoStyle" xmlns="http://www.w3.org/1999/xhtml">
    <a class="mtps-internal-link" href="ms-xhelp:///?id=T:AlfaAccounting.Controllers.BookingViewModelsController">BookingViewModelsController Class</a>
  </div>
  <div class="seeAlsoStyle" xmlns="http://www.w3.org/1999/xhtml">
    <a class="mtps-internal-link" href="ms-xhelp:///?id=AllMembers.T:AlfaAccounting.Controllers.BookingViewModelsController">BookingViewModelsController Members</a>
  </div>



	  <div class="seeAlsoStyle" xmlns="http://www.w3.org/1999/xhtml">
	    <a class="mtps-internal-link" href="ms-xhelp:///?Id=N:AlfaAccounting.Controllers">AlfaAccounting.Controllers Namespace</a>
	  </div>


		

</CollapsibleArea>
        </div>
      </div>
      
			<div class="OH_footer">
				<p><span style="color:#FF0000;">Generated with unregistered version of <a href="ms-xhelp:///?Id=http://www.helixoft.com/vsdocman/overview.html">VSdocman</a></span>&#32;<br />
Your own footer text will only be shown in registered version.
				</p>
			</div>
      
    </div>
  </body>
</html>

   